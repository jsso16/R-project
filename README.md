# R-project - 602277119 전소진
Open data R with Shiny 2022

## 09월 14일
> 자료 수집: API 크롤러 만들기

**1. 크롤링 준비: 무엇을 준비할까?**
- 크롤링을 시작하기 위해서는 여러가지 설정을 해주어야 한다.
- 이러한 설정을 진행하기 위한 단계로는 총 4가지가 있다.
```r
1. 작업 폴더 설정하기

install.packages("rstudioapi")  # rstudioapi 설치
setwd(dirname(rstudioqpi::getSourceEditorContext()$path))  # 작업 폴더 설정
getwd()  # 작업 폴더 확인
```
- rstudioapi라는 라이브러리를 이용하면 스크립트가 저장된 위치를 작업 폴더로 쉽게 설정할 수 있다.
```r
2. 수집 대상 지역 설정하기

loc <- read.csv("../sigun_code/sigun_code.csv")  # 지역 코드
loc$code <- as.character(loc$code)  # 행정구역명 문자 변환
head(loc, 2)  # 확인
```
- 이때, head() 함수는 데이터를 가져올 때 처음 값부터 차례대로 가져오는데, 마지막 값부터 확인하고 싶다면 tail() 함수를 대신 사용하면 된다.
- 지역코드란 기초 자치 단체인 시·군·구에 할당한 코드로서 광역시·도(2자리) + 기초 시·군·구(3자리)로 이루어진 코드를 의미한다.
- 지역코드 예시는 아래와 같다.
<img width="634" alt="지역 코드 예시" src="https://user-images.githubusercontent.com/62285642/190842573-c5019527-478e-4a59-b669-8bfe143f783a.png">

```r
3. 수집 기간 설정하기

datelist <- seq(from = as.Date('2021-01-01'),  #시작
                to = as.Date('2021-12-31'),  # 종료
                by = '1 month')  # 단위
datelist <- format(datelist, format = '%Y%m')  # 형식 변환(YYYY-MM-DD => YYYYMM)
datelist[1:3]  # 확인
```
- seq() 함수는 등차수열을 만들 때 활용하는 함수이다.
- 따라서 원하는 기간동안 일정한 간격의 데이터를 출력하기 위해서는 from - to를 이용해 수집 기간을 설정하고, by를 통해 수집 기간의 간격을 설정한다.
```r
4. 인증키 입력하기

service_key <- "인증키"  # 인증키 입력
```
- 인증키는 이전처럼 개발 계정의 상세보기 화면에서 일반 인증키(Encoding) 항목을 확인하면 된다.

## 09월 07일
> 자료 수집 전에 알아야 할 내용

**1. 자료는 어디서 구할까?**
- 자료 수집은 데이터 분석 과정의 첫 관문이다.
- 어떤 자료를 어떻게 수집할 지에 따라 분석에 소용되는 시간과 비용 그리고 결과물의 수준이 결정된다.
- 자료를 수집하기 위해서는 크롤러가 필요하며, 이를 직접 만드는 일은 까다롭다.
- 그러나 공공데이터포털 같은 곳에서는 이러한 데이터를 다양하게 이용할 수 있도록 API를 제공한다.

**+) 공공데이터란?**
- 공공기관이 법령에 따라 생성, 수집하는 전자적 형태의 정보로써 개방 가능한 모든 데이터를 의미한다.
- 이러한 공공데이터를 한 곳에 모아 제공하는 통합 플랫폼이 바로 [공공데이터포털](https://www.data.go.kr/)이다.

**2. API 인증키 얻기**
- 공공데이터포털에서 인증키를 발급받기 위해서는 공공데이터포털에 접속하여 회원가입 및 로그인을 해야한다.
- API 인증키를 얻기 위해서는 총 2가지 단계를 시행해야 한다.
```
1. API 활용 신청하기
  - 공공데이터포털 첫 화면의 검색란에 필요한 자료 입력하기
  → 검색 결과 화면의 [오픈 API] 탭 클릭하기
  → 목록에서 필요한 자료를 찾은 후, 오른쪽의 <활용신청> 클릭하기
  → 'OpenAPI 개발계정 신청' 화면에서 심의 여부 확인 후, 활용목적 작성하기
  → 모든 정보 작성 및 확인 후 확인 버튼 누르기
```
- 이때, 'OpenAPI 개발계정 신청' 화면에서 심의 여부를 확인해보면 '자동승인'이라고 적혀있는 경우가 있다.
- 이 경우, 따로 심사하지 않고 신청하면 곧바로 사용할 수 있다.
- 그러나 신청한 API는 바로 호출이 불가능하며, 1~2시간 후 호출 가능하다.
```
2. 승인 및 인증키 확인하기
  - 포털 사이트 위쪽 메뉴에서 [마이 페이지] 클릭하기
  → 신청한 자료명 앞에 [승인]이 붙어있는지 확인하기
  → 승인 완료된 자료를 클릭 후, 상세보기 화면에서 일반 인증키(Encoding) 확인하기
```
- 마이 페이지의 개발 계정 화면에서는 신청과 활용, 중지 건수를 확인할 수 있는데, 이때 신청한 자료가 승인되면 활용 건수로 바뀌고 목록에서 해당 자료명 앞에 [승인]이 붙는다.
- 상세보기 화면의 다양한 정보 중 일반 인증키(Encoding) 항목의 데이터가 API를 이용할 때 필요한 인증키로, 각자 발급받은 이 고유한 인증키로 서버에 자료를 요청한다.

**3. API에 자료 요청하기**
- API에 자료를 요청하기 위해서는 총 3가지 단계를 시행해야 한다.
- 이 단계를 시행하기 위해서는 아래의 문서가 필요하다.<br>
  → 참고문서 : [아파트 매매 신고정보 조회 기술문서.hwp](https://www.data.go.kr/data/15058747/openapi.do)
```
1. 서비스 URL 확인하기
 - 기술 문서 4페이지의 상세 기능 정보에서 'Call Back URL' 항목의 주소 확인하기
```
```
2. 요청 변수 확인하기
  - 기술 문서 4페이지의 요청 메시지 명세에서 LAWD_CD, DEAL_YMD, serviceKey 3가지 정보 확인하기
```
- 위 정보를 조합해 하나의 요청 URL로 만들어서 API에 요청하면 서버가 해당 자료를 찾아서 보내준다.
```
3. 요청 URL 만들기
  - 2단계에서 확인한 지역 코드와 거래 연월 그리고 발급받은 인증키 채워넣기
```
- 데이터 요청을 위한 URL 작성 예시는 아래와 같다.
```
서비스URL?LAWD_CD=지역코드&DEAL_YMD=거래연월&serviceKey=인증키
```
- 이렇게 만든 URL을 웹 브라우저 주소 창에 입력한 후 Enter를 누르면 서버로부터 XML 형태로 응답받은 데이터를 확인할 수 있다.

**4. API 응답 확인하기**
- API 응답을 확인하기 위해서는 총 2가지 단계를 시행해야 한다.
```
1. 응답 내역 알아보기
  - API로 자료를 요청해서 XML 형태로 응답받은 데이터의 응답 상태와 응답 내역 구성 확인하기
```
- XML은 컴퓨터끼리 데이터를 원활하게 전달하는 것을 목적으로 만든 언어이며, 모든 XML 데이터는 루트 노드에서 출발하며 부모-자식 관계로 연결되어 있다.
- API에서 자료를 요청할 때 얻을 수 있는 데이터가 바로 이러한 XML 형태이다.
```
2. XML 형태의 응답 내역 확인하기
  - 요청 URL과 응답 결과 확인하기
```
- 요청 URL과 응답 결과 예시는 다음과 같다.
<img width="749" alt="XML 응답 내역 예시" src="https://user-images.githubusercontent.com/62285642/189472658-ffdb3d5e-2631-4cb9-b106-a1992ec8159a.png">

> 텍스트 마이닝과 워드 클라우드 활용

**1. 텍스트 마이닝과 워드 클라우드**
- 텍스트 마이닝이란 비정형 텍스트에서 의미 있는 정보를 찾아내는 mining 기술을 의미한다.
- 단어 분류 또는 문법적 구조 분석 등의 자연언어 처리 기술에 기반한다.
- 문서 분류, 관련있는 문서들의 군집화, 정보의 추출, 문서 요약 등에 활용된다.

**2. 지역별 인구 변화 수에 대한 워드 클라우드 출력**
- 워드클라우드를 이용하여 통계청에 있는 다양한 자료들 중, '시·군·구별 이동자 수' 자료를 이용하여 지역별 전입과 전출에 의한 순이동 인구수를 비교할 수 있다.
- 워드클라우드를 생성하는 코드는 아래와 같다.
```r
install.packages("wordcloud") 
library(wordcloud)

word <- c("인천광역시", "강화군", "웅진군")  # 단어 할당
frequency <- c(651, 85, 61)  # 단어별 빈도 할당

wordcloud(word, frequency, colors="blue",family="AppleGothic")  # 워드클라우드 출력
```